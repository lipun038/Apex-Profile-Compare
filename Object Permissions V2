//For Object Permission
string csvString = 'Object Name,Permission Name,Commercial Portal Standard User,Commercial Portal Read Only User';
Set<string> sObjectTypeSet = new Set<string>();
//Map<string,ObjectPermissions> obMap1 = new Map<string,ObjectPermissions>();
Map<string,ObjectPermissions> obMap2 = new Map<string,ObjectPermissions>();
Map<string,ObjectPermissions> obMap3 = new Map<string,ObjectPermissions>();
for(ObjectPermissions ob1 : [SELECT SObjectType, PermissionsRead, PermissionsCreate, PermissionsEdit, PermissionsDelete, PermissionsViewAllRecords, PermissionsModifyAllRecords FROM ObjectPermissions WHERE Parent.Profile.Name='System Administrator' ORDER BY SObjectType]){
	//obMap1.put(ob1.SObjectType,ob1);
	sObjectTypeSet.add(ob1.SObjectType);    
}
for(ObjectPermissions ob2 : [SELECT SObjectType, PermissionsRead, PermissionsCreate, PermissionsEdit, PermissionsDelete, PermissionsViewAllRecords, PermissionsModifyAllRecords FROM ObjectPermissions WHERE Parent.Profile.Name='Commercial Portal Standard User' ORDER BY SObjectType]){
	obMap2.put(ob2.SObjectType,ob2); 
}

for(ObjectPermissions ob3 : [SELECT SObjectType, PermissionsRead, PermissionsCreate, PermissionsEdit, PermissionsDelete, PermissionsViewAllRecords, PermissionsModifyAllRecords FROM ObjectPermissions WHERE Parent.Profile.Name='Commercial Portal Read Only User' ORDER BY SObjectType]){
	obMap3.put(ob3.SObjectType,ob3); 
}

for(string sObjectType : sObjectTypeSet){
    ObjectPermissions ob2 = obMap2.get(sObjectType);
	ObjectPermissions ob3 = obMap3.get(sObjectType);
    csvString += '\n'+sObjectType+',Read,'+ (ob2 == Null ? '0' : ob2.PermissionsRead ? '1':'0')+','+(ob3 == Null ? '0' : ob3.PermissionsRead ? '1':'0');
    csvString += '\n'+sObjectType+',Create,'+ (ob2 == Null ? '0' : ob2.PermissionsCreate ? '1':'0')+','+(ob3 == Null ? '0' : ob3.PermissionsCreate ? '1':'0');
    csvString += '\n'+sObjectType+',Edit,'+ (ob2 == Null ? '0' : ob2.PermissionsEdit ? '1':'0')+','+(ob3 == Null ? '0' : ob3.PermissionsEdit ? '1':'0');
    csvString += '\n'+sObjectType+',Delete,'+ (ob2 == Null ? '0' : ob2.PermissionsDelete ? '1':'0')+','+(ob3 == Null ? '0' : ob3.PermissionsDelete ? '1':'0');
    csvString += '\n'+sObjectType+',View All,'+ (ob2 == Null ? '0' : ob2.PermissionsViewAllRecords ? '1':'0')+','+(ob3 == Null ? '0' : ob3.PermissionsViewAllRecords ? '1':'0');
    csvString += '\n'+sObjectType+',Modify All,'+ (ob2 == Null ? '0' : ob2.PermissionsModifyAllRecords ? '1':'0')+','+(ob3 == Null ? '0' : ob3.PermissionsModifyAllRecords ? '1':'0');  
       
}
Attachment att = new Attachment();
att.Body = Blob.valueOf(csvString);
att.ContentType = '.csv';
att.Name = 'Object.csv';
att.ParentId = '0012M00002DS9Yo';
insert att;
